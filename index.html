<!doctype html>
<html lang="en" class="scroll-smooth" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BedShirt — Cozy Premium Bedshirts</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Vanta.js background -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>

  <!-- Tailwind extend (colors & fonts) -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cozy: {
              orange: '#FF8C42',
              cream: '#FFF5EB',
              brown: '#5E3023',
              tan: '#D7B49E',
              warm: '#F2D0A4'
            }
          },
          fontFamily: {
            sans: ['"DM Sans"', 'sans-serif'],
            serif: ['"DM Serif Display"', 'serif']
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Serif+Display:ital@0;1&display=swap');
    body { font-family: 'DM Sans', sans-serif; background: #FFF5EB; color: #5E3023; -webkit-font-smoothing:antialiased; }
    .vanta-bg { position: fixed; inset: 0; z-index: -1; opacity: .14; }
    .product-card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(0,0,0,0.09); }
    .language-selector:hover .language-dropdown { display:block; }
    :focus { outline: 3px solid rgba(255,140,66,0.12); outline-offset:3px; }
    html[dir="rtl"] body { direction: rtl; }
  </style>
</head>
<body class="antialiased">

  <!-- Vanta background container -->
  <div id="vanta-bg" class="vanta-bg"></div>

  <!-- Header -->
  <header class="bg-cozy-cream shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <!-- Logo (click 5x to open admin too) -->
      <div class="flex items-center space-x-3 cursor-pointer" id="logoWrap" title="Click 5 times for admin">
        <svg id="logoSvg" xmlns="http://www.w3.org/2000/svg" class="w-9 h-9 text-[color:var(--cozy-orange)]" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2.5 5.5L20 9l-4 3.5L17 20l-5-2.5L7 20l1-7.5L4 9l5.5-1.5L12 2z"/></svg>
        <a href="#home" class="font-serif text-2xl font-bold">BedShirt</a>
      </div>

      <!-- Search -->
      <div class="hidden md:flex flex-1 mx-8">
        <div class="relative w-full">
          <input id="globalSearch" type="text" placeholder="Search for bedshirts, styles, collections..."
                 class="w-full py-2 px-4 rounded-lg border border-cozy-tan focus:outline-none focus:ring-2 focus:ring-cozy-orange" />
          <button id="searchBtn" class="absolute right-0 top-0 h-full px-4 bg-cozy-orange text-white rounded-r-lg hover:opacity-95">
            <i data-feather="search"></i>
          </button>
        </div>
      </div>

      <!-- Nav -->
      <nav class="flex items-center space-x-4">
        <!-- language dropdown (non-functional but present) -->
        <div class="language-selector relative">
          <button id="langBtn" class="flex items-center gap-1 px-2 py-1 rounded-md hover:bg-white/50">
            <i data-feather="globe"></i><span id="langLabel">EN</span><i data-feather="chevron-down" class="w-4 h-4"></i>
          </button>
          <div id="langDropdown" class="language-dropdown hidden absolute right-0 mt-2 w-36 bg-white rounded-md shadow-lg py-1 z-50">
            <button class="w-full text-left px-4 py-2 hover:bg-cozy-cream" data-lang="en">English</button>
            <button class="w-full text-left px-4 py-2 hover:bg-cozy-cream" data-lang="fr">Français</button>
            <button class="w-full text-left px-4 py-2 hover:bg-cozy-cream" data-lang="ar">العربية</button>
          </div>
        </div>

        <a href="#wishlist" class="relative" title="Wishlist">
          <i data-feather="heart" class="w-6 h-6"></i>
          <span id="wishCount" class="absolute -top-2 -right-2 bg-cozy-orange text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </a>

        <a href="#cart" onclick="openCart()" class="relative" title="Cart">
          <i data-feather="shopping-cart" class="w-6 h-6"></i>
          <span id="cartBadge" class="absolute -top-2 -right-2 bg-cozy-orange text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </a>

        <a href="#account" id="accountLink" class="flex items-center gap-1">
          <i data-feather="user" class="w-6 h-6"></i>
          <span class="hidden md:inline">Account</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main>

    <!-- Hero -->
    <section id="home" class="relative bg-gradient-to-r from-cozy-tan to-cozy-warm">
      <div class="container mx-auto px-4 py-16 md:py-24">
        <div class="max-w-3xl">
          <h1 class="text-4xl md:text-5xl font-serif font-bold mb-4">Wrap Yourself in Comfort</h1>
          <p class="text-lg md:text-xl mb-6">Discover bedshirts inspired by warm fabrics and crafted for comfort — a cozy, magical experience.</p>
          <div class="flex gap-4 hero-cta">
            <a href="#products" class="inline-block bg-cozy-orange text-white px-6 py-3 rounded-lg font-medium hover:bg-opacity-95">Shop Now</a>
            <a href="#collections" class="inline-block border border-cozy-orange text-[color:var(--cozy-brown)] px-5 py-3 rounded-lg hover:bg-[color:var(--cozy-cream)]">Collections</a>
          </div>
        </div>
      </div>
      <div class="absolute bottom-0 left-0 w-full h-16 bg-gradient-to-t from-cozy-cream to-transparent"></div>
    </section>

    <!-- Collections -->
    <section id="collections" class="py-12 bg-cozy-cream">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-serif font-bold text-center mb-8">Our Collections</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <a href="#products" class="bg-white rounded-lg p-4 text-center hover:shadow-md transition">
            <div class="bg-cozy-cream rounded-full w-24 h-24 mx-auto mb-3 flex items-center justify-center">
              <i data-feather="sun" class="text-cozy-orange w-10 h-10"></i>
            </div>
            <h3 class="font-medium">Summer Bedshirts</h3>
          </a>
          <a href="#products" class="bg-white rounded-lg p-4 text-center hover:shadow-md transition">
            <div class="bg-cozy-cream rounded-full w-24 h-24 mx-auto mb-3 flex items-center justify-center">
              <i data-feather="cloud" class="text-cozy-orange w-10 h-10"></i>
            </div>
            <h3 class="font-medium">Winter Bedshirts</h3>
          </a>
          <a href="#products" class="bg-white rounded-lg p-4 text-center hover:shadow-md transition">
            <div class="bg-cozy-cream rounded-full w-24 h-24 mx-auto mb-3 flex items-center justify-center">
              <i data-feather="droplet" class="text-cozy-orange w-10 h-10"></i>
            </div>
            <h3 class="font-medium">Duvet Covers</h3>
          </a>
          <a href="#products" class="bg-white rounded-lg p-4 text-center hover:shadow-md transition">
            <div class="bg-cozy-cream rounded-full w-24 h-24 mx-auto mb-3 flex items-center justify-center">
              <i data-feather="star" class="text-cozy-orange w-10 h-10"></i>
            </div>
            <h3 class="font-medium">Premium Collection</h3>
          </a>
        </div>
      </div>
    </section>

    <!-- Products -->
    <section id="products" class="py-12">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl md:text-3xl font-serif font-bold">Featured Products</h2>
          <div class="flex items-center gap-3">
            <label class="text-sm text-gray-600">Sort:</label>
            <select id="sortSelect" class="rounded-md border px-2 py-1">
              <option value="featured">Featured</option>
              <option value="price_asc">Price: Low → High</option>
              <option value="price_desc">Price: High → Low</option>
              <option value="popularity">Popularity</option>
            </select>
          </div>
        </div>

        <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
          <!-- products inserted by JS -->
        </div>

        <div class="text-center mt-10">
          <button id="viewAllBtn" class="inline-block border border-cozy-orange text-cozy-orange px-6 py-2 rounded-lg font-medium hover:bg-cozy-orange hover:text-white transition">View All Products</button>
        </div>
      </div>
    </section>

    <!-- Bestsellers -->
    <section id="bestsellers" class="py-12 bg-cozy-cream">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-serif font-bold text-center mb-8">Bestsellers</h2>
        <div id="bestsellersGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
      </div>
    </section>

    <!-- Testimonials -->
    <section class="py-12">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-serif font-bold text-center mb-8">What Our Customers Say</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex items-center mb-4"><div class="flex text-yellow-400"><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i></div></div>
            <p class="text-gray-700 mb-4">"The most comfortable bedshirt I've owned. Like sleeping on a cloud."</p>
            <div class="flex items-center"><img src="https://i.pravatar.cc/48?img=12" class="w-10 h-10 rounded-full mr-3"/><div><strong>Sarah J.</strong><div class="text-sm text-gray-500">Verified Buyer</div></div></div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex items-center mb-4"><div class="flex text-yellow-400"><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i></div></div>
            <p class="text-gray-700 mb-4">"Beautiful design and quality — my bedroom feels cozier now."</p>
            <div class="flex items-center"><img src="https://i.pravatar.cc/48?img=7" class="w-10 h-10 rounded-full mr-3"/><div><strong>Michael T.</strong><div class="text-sm text-gray-500">Verified Buyer</div></div></div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex items-center mb-4"><div class="flex text-yellow-400"><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i><i data-feather="star" class="w-4 h-4"></i></div></div>
            <p class="text-gray-700 mb-4">"Fast shipping and excellent service. Will buy again!"</p>
            <div class="flex items-center"><img src="https://i.pravatar.cc/48?img=5" class="w-10 h-10 rounded-full mr-3"/><div><strong>Amina K.</strong><div class="text-sm text-gray-500">Verified Buyer</div></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter -->
    <section class="py-12 bg-cozy-orange text-white">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-2xl md:text-3xl font-serif font-bold mb-4">Stay Cozy With Our Newsletter</h2>
        <p class="max-w-2xl mx-auto mb-6">Subscribe for 10% off your first order and updates on new arrivals.</p>
        <form id="newsletterForm" class="max-w-lg mx-auto flex">
          <input id="newsletterEmail" type="email" placeholder="Your email address" class="flex-1 py-3 px-4 rounded-l-lg focus:outline-none text-gray-800" required>
          <button type="submit" class="bg-cozy-brown text-white px-6 py-3 rounded-r-lg font-medium hover:opacity-95">Subscribe</button>
        </form>
      </div>
    </section>

    <!-- About & Contact -->
    <section id="about" class="py-12 bg-cozy-cream">
      <div class="container mx-auto px-4 grid md:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="font-serif text-2xl font-bold mb-3">About Us</h3>
          <p>We craft bedshirts with love — small batches, premium fabrics, and careful finishing. Our goal is warmth, comfort and style.</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="font-serif text-2xl font-bold mb-3">Contact</h3>
          <form id="contactForm">
            <label class="block mb-2">Name <input name="name" required class="w-full border px-3 py-2 rounded-md mt-1" /></label>
            <label class="block mb-2">Email <input name="email" type="email" required class="w-full border px-3 py-2 rounded-md mt-1" /></label>
            <label class="block mb-2">Message <textarea name="message" class="w-full border px-3 py-2 rounded-md mt-1"></textarea></label>
            <button class="bg-cozy-orange text-white px-4 py-2 rounded-md">Send Message</button>
          </form>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="bg-cozy-brown text-cozy-cream py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-xl font-serif font-bold mb-4">BedShirt</h3>
          <p class="mb-4">Premium bedshirts for warmth and style</p>
          <div class="flex gap-4 mt-4">
            <a href="#" class="hover:text-cozy-orange"><i data-feather="facebook"></i></a>
            <a href="#" class="hover:text-cozy-orange"><i data-feather="instagram"></i></a>
            <a href="#" class="hover:text-cozy-orange"><i data-feather="twitter"></i></a>
          </div>
        </div>

        <div>
          <h4 class="font-medium uppercase text-sm mb-4">Shop</h4>
          <ul class="space-y-2">
            <li><a href="#products" class="hover:text-cozy-orange">All Products</a></li>
            <li><a href="#bestsellers" class="hover:text-cozy-orange">Best Sellers</a></li>
            <li><a href="#collections" class="hover:text-cozy-orange">Collections</a></li>
            <li><a href="#contact" class="hover:text-cozy-orange">Contact</a></li>
          </ul>
        </div>

        <div>
          <h4 class="font-medium uppercase text-sm mb-4">Help</h4>
          <ul class="space-y-2">
            <li><a href="#" class="hover:text-cozy-orange">FAQs</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Shipping & Returns</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Size Guide</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Track Order</a></li>
          </ul>
        </div>

        <div>
          <h4 class="font-medium uppercase text-sm mb-4">Company</h4>
          <ul class="space-y-2">
            <li><a href="#about" class="hover:text-cozy-orange">About Us</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Our Story</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Sustainability</a></li>
            <li><a href="#" class="hover:text-cozy-orange">Blog</a></li>
          </ul>
        </div>
      </div>

      <div class="border-t border-cozy-tan mt-12 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-sm mb-4 md:mb-0">© <span id="yearLabel"></span> BedShirt. All rights reserved.</p>
        <div class="flex space-x-6">
          <a href="#" class="text-sm hover:text-cozy-orange">Privacy Policy</a>
          <a href="#" class="text-sm hover:text-cozy-orange">Terms</a>
          <a href="#" class="text-sm hover:text-cozy-orange">Cookies</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Mobile bottom nav -->
  <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg py-3 px-6 flex justify-around items-center">
    <a href="#home" class="flex flex-col items-center"><i data-feather="home" class="w-5 h-5"></i><span class="text-xs mt-1">Home</span></a>
    <a href="#products" class="flex flex-col items-center"><i data-feather="grid" class="w-5 h-5"></i><span class="text-xs mt-1">Shop</span></a>
    <a href="#wishlist" class="flex flex-col items-center"><i data-feather="heart" class="w-5 h-5"></i><span class="text-xs mt-1">Wishlist</span></a>
    <a href="#cart" onclick="openCart()" class="flex flex-col items-center"><i data-feather="shopping-cart" class="w-5 h-5"></i><span class="text-xs mt-1">Cart</span></a>
    <a href="#account" class="flex flex-col items-center"><i data-feather="user" class="w-5 h-5"></i><span class="text-xs mt-1">Account</span></a>
  </div>

  <!-- Cart Drawer -->
  <div id="cartDrawer" class="fixed right-0 top-0 h-full w-96 max-w-[95%] bg-white shadow-xl transform translate-x-full transition-transform z-50">
    <div class="p-4 border-b flex items-center justify-between">
      <h3 class="font-bold">Cart</h3>
      <button onclick="closeCart()" aria-label="Close" class="p-2 rounded-md hover:bg-gray-100"><i data-feather="x"></i></button>
    </div>
    <div id="cartContents" class="p-4 overflow-auto" style="max-height:calc(100vh - 200px)"></div>
    <div class="p-4 border-t">
      <div class="flex justify-between mb-3"><span>Shipping</span><span id="shippingValue">0 DZD</span></div>
      <div class="flex justify-between mb-3"><strong>Total</strong><strong id="cartTotal">0 DZD</strong></div>
      <div class="flex gap-2">
        <button class="flex-1 bg-cozy-orange text-white py-2 rounded-md" onclick="checkout()">Checkout</button>
        <button class="flex-1 border rounded-md py-2" onclick="clearCart()">Clear</button>
      </div>
    </div>
  </div>

  <!-- Admin modal (hidden) -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-60">
    <div id="modalPanel" class="bg-white rounded-lg max-w-4xl w-full p-6 shadow-lg overflow-auto max-h-[90vh]"></div>
  </div>

  <!-- Script: shop logic, admin footprint, localStorage persistence -->
  <script>
  // ---------- Config & demo data ----------
  const shippingMap = {
    'dzcarsorient.com': 800,
    'librairie-manolia.com': 600,
    'dopebook.store': 1000
  };
  function getShipping() {
    const host = window.location.hostname || 'local';
    return shippingMap[host] ?? 700;
  }

  const demoProducts = [
    { id: 'p1', title: 'Bedshirt Coton Crème', price: 4200, collection: 'Classique', img: 'https://images.unsplash.com/photo-1540574163026-643ea20ade25?w=1200&q=80', stock: 12, rating: 4.6, reviews: 128 },
    { id: 'p2', title: 'Bedshirt Lin Beige', price: 7600, collection: 'Luxe', img: 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=1200&q=80', stock: 6, rating: 4.9, reviews: 245 },
    { id: 'p3', title: 'Bedshirt Promo Bleu', price: 2500, collection: 'Promo', img: 'https://images.unsplash.com/photo-1520975917451-8d3a4e3f7e3d?w=1200&q=80', stock: 18, rating: 4.4, reviews: 187 },
    { id: 'p4', title: 'Silk Embroidered Bedshirt', price: 12999, collection: 'Premium', img: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&q=80', stock: 4, rating: 5.0, reviews: 312 }
  ];

  function ensureStorage() {
    if(!localStorage.getItem('bs_products')) localStorage.setItem('bs_products', JSON.stringify(demoProducts));
    if(!localStorage.getItem('bs_orders')) localStorage.setItem('bs_orders', JSON.stringify([]));
    if(!localStorage.getItem('bs_sales')) localStorage.setItem('bs_sales', JSON.stringify({}));
    if(!localStorage.getItem('bs_cart')) localStorage.setItem('bs_cart', JSON.stringify({}));
    if(!localStorage.getItem('bs_wishlist')) localStorage.setItem('bs_wishlist', JSON.stringify({}));
  }
  ensureStorage();

  // ---------- UI init ----------
  document.getElementById('yearLabel').innerText = new Date().getFullYear();
  feather.replace();

  try {
    VANTA.NET({ el: "#vanta-bg", color: 0xFF8C42, backgroundColor: 0xFFF5EB, points: 8.0, maxDistance: 20.0, spacing: 15.0 });
  } catch(e){ /* ignore */ }

  // ---------- Product rendering ----------
  function formatPrice(v){ return v.toLocaleString() + ' DZD'; }
  function renderStars(rating){
    const full = Math.round(rating || 5);
    let html = '';
    for(let i=0;i<5;i++){
      html += `<svg class="w-4 h-4 ${i<full ? 'fill-current text-yellow-400' : 'text-gray-300'}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .587l3.668 7.431L23.6 9.753l-5.8 5.648L19.6 24 12 19.897 4.4 24l1.8-8.599L.4 9.753l7.932-1.735z"/></svg>`;
    }
    return html;
  }

  function loadProducts() {
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]');
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    prods.forEach(p => {
      const card = document.createElement('article');
      card.className = 'product-card bg-white rounded-lg overflow-hidden shadow-md transition duration-300';
      card.innerHTML = `
        <div class="relative h-64 overflow-hidden">
          <img src="${p.img}" alt="${p.title}" class="w-full h-full object-cover" loading="lazy" />
          <div class="absolute top-2 right-2">
            <button class="p-2 bg-white rounded-full shadow-md hover:bg-cozy-cream wish-btn" data-id="${p.id}" aria-label="Wishlist">
              <i data-feather="heart" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
        <div class="p-4">
          <h3 class="font-medium text-lg mb-1">${p.title}</h3>
          <div class="flex items-center mb-2"><div class="flex">${renderStars(p.rating)}</div><span class="text-sm text-gray-500 ml-2">(${p.reviews||0})</span></div>
          <div class="flex justify-between items-center">
            <span class="font-bold text-[color:var(--cozy-orange)]">${formatPrice(p.price)}</span>
            <div class="flex gap-2">
              <button class="px-3 py-1 border rounded" onclick="showQuick('${p.id}')">Quick View</button>
              <button class="add-to-cart p-2 bg-cozy-orange text-white rounded-full hover:bg-opacity-90" data-id="${p.id}" aria-label="Add to cart"><i data-feather="shopping-cart" class="w-4 h-4"></i></button>
            </div>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
    feather.replace();
    attachProductButtons();
  }

  function attachProductButtons(){
    document.querySelectorAll('.add-to-cart').forEach(btn=>{
      btn.removeEventListener('click', onAddToCart); btn.addEventListener('click', onAddToCart);
    });
    document.querySelectorAll('.wish-btn').forEach(b=>{ b.removeEventListener('click', onToggleWishlist); b.addEventListener('click', onToggleWishlist); });
  }
  function onAddToCart(e){
    const id = e.currentTarget.dataset.id;
    addToCart(id);
    const btn = e.currentTarget;
    btn.innerHTML = '<i data-feather="check" class="w-4 h-4"></i>'; feather.replace();
    setTimeout(()=>{ btn.innerHTML = '<i data-feather="shopping-cart" class="w-4 h-4"></i>'; feather.replace(); },900);
  }
  function onToggleWishlist(e){
    const id = e.currentTarget.dataset.id; toggleWishlist(id);
  }

  // ---------- Cart ----------
  function getCart(){ return JSON.parse(localStorage.getItem('bs_cart')||'{}'); }
  function saveCart(c){ localStorage.setItem('bs_cart', JSON.stringify(c)); updateCartUI(); }
  function addToCart(id, qty=1){
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); if(!prods.find(p=>p.id===id)){ alert('Product not found'); return; }
    const cart = getCart(); cart[id] = (cart[id]||0) + qty; saveCart(cart);
    toast('Added to cart');
  }
  function removeFromCart(id){ const cart = getCart(); delete cart[id]; saveCart(cart); }
  function clearCart(){ localStorage.removeItem('bs_cart'); updateCartUI(); }
  function changeQty(id, qty){ if(qty<=0){ removeFromCart(id); return;} const cart = getCart(); cart[id]=qty; saveCart(cart); }

  function updateCartUI(){
    const cart = getCart(); const prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); const contents = document.getElementById('cartContents'); contents.innerHTML=''; let total=0, count=0;
    for(const id in cart){
      const qty = cart[id]; const p = prods.find(x=>x.id===id); if(!p) continue;
      const line = document.createElement('div'); line.className='flex items-center gap-3 mb-3';
      line.innerHTML = `<img src="${p.img}" class="w-16 h-16 object-cover rounded-md" /><div class="flex-1"><div class="font-medium">${p.title}</div><div class="text-sm text-gray-500">${formatPrice(p.price)} x ${qty}</div></div><div class="flex flex-col gap-1"><button class="text-sm px-2 py-1 border rounded" onclick="changeQty('${id}', ${Math.max(0, qty-1)})">-</button><button class="text-sm px-2 py-1 border rounded" onclick="changeQty('${id}', ${qty+1})">+</button><button class="text-xs text-red-600" onclick="removeFromCart('${id}')">Remove</button></div>`;
      contents.appendChild(line);
      total += p.price * qty; count += qty;
    }
    const shipping = getShipping();
    document.getElementById('shippingValue').innerText = shipping.toLocaleString() + ' DZD';
    document.getElementById('cartTotal').innerText = (total + shipping).toLocaleString() + ' DZD';
    document.getElementById('cartBadge').innerText = count;
  }

  function openCart(){ document.getElementById('cartDrawer').style.transform = 'translateX(0)'; updateCartUI(); }
  function closeCart(){ document.getElementById('cartDrawer').style.transform = 'translateX(100%)'; }

  // ---------- Wishlist ----------
  function toggleWishlist(id){
    const w = JSON.parse(localStorage.getItem('bs_wishlist')||'{}');
    if(w[id]) delete w[id]; else w[id]=1;
    localStorage.setItem('bs_wishlist', JSON.stringify(w));
    document.getElementById('wishCount').innerText = Object.keys(w).length;
    toast(Object.keys(w).includes(id) ? 'Added to wishlist' : 'Removed from wishlist');
  }

  // ---------- Checkout & orders ----------
  function checkout(){
    const cart = getCart(); if(Object.keys(cart).length===0) return alert('Cart is empty');
    showModal(`
      <h3 class="text-xl font-bold mb-3">Checkout</h3>
      <form id="checkoutForm" class="space-y-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <input name="name" placeholder="Full name" class="border p-2 rounded" required />
          <input name="phone" placeholder="Phone" class="border p-2 rounded" required />
          <input name="address" placeholder="Address" class="border p-2 rounded md:col-span-2" required />
          <select name="pay" class="border p-2 rounded"><option value="cod">Cash on Delivery</option><option value="card">Card (demo)</option></select>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" class="px-4 py-2 border rounded" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-cozy-orange text-white rounded">Pay</button>
        </div>
      </form>
    `);
    document.getElementById('checkoutForm').addEventListener('submit', function(ev){
      ev.preventDefault();
      processOrder(new FormData(ev.target));
    });
  }

  function processOrder(formData){
    const cart = getCart(); const products = JSON.parse(localStorage.getItem('bs_products')||'[]');
    const orders = JSON.parse(localStorage.getItem('bs_orders')||'[]'); const sales = JSON.parse(localStorage.getItem('bs_sales')||'{}');
    let subtotal = 0; const items = [];
    for(const id in cart){
      const qty = cart[id]; const p = products.find(x=>x.id===id); if(!p) continue;
      items.push({ id: p.id, title: p.title, price: p.price, qty });
      subtotal += p.price * qty;
      sales[p.id] = (sales[p.id]||0) + qty;
      p.stock = Math.max(0, (p.stock||0) - qty);
    }
    const shipping = getShipping();
    const order = { id: 'o'+Date.now(), date: new Date().toISOString(), customer: { name: formData.get('name'), phone: formData.get('phone'), address: formData.get('address') }, payment: formData.get('pay'), items, subtotal, shipping, total: subtotal + shipping };
    orders.push(order);
    localStorage.setItem('bs_orders', JSON.stringify(orders));
    localStorage.setItem('bs_sales', JSON.stringify(sales));
    localStorage.setItem('bs_products', JSON.stringify(products));
    localStorage.removeItem('bs_cart');
    updateCartUI(); closeModal(); toast('Order placed — ID: '+order.id);
    loadBestsellers(); loadProducts();
  }

  // ---------- Bestsellers ----------
  function loadBestsellers(){
    const sales = JSON.parse(localStorage.getItem('bs_sales')||'{}');
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]');
    const arr = Object.keys(sales).map(id => ({ id, qty: sales[id] })).sort((a,b)=>b.qty-a.qty);
    const grid = document.getElementById('bestsellersGrid'); grid.innerHTML='';
    if(arr.length === 0){ grid.innerHTML = '<div class="text-center text-gray-600">No bestsellers yet — sell some!</div>'; return; }
    arr.slice(0,6).forEach(s=>{
      const p = prods.find(x=>x.id===s.id); if(!p) return;
      const card = document.createElement('div'); card.className='bg-white p-4 rounded-lg shadow-md flex gap-4';
      card.innerHTML = `<img src="${p.img}" class="w-24 h-24 object-cover rounded" /><div class="flex-1"><strong>${p.title}</strong><div class="text-sm text-gray-500">${s.qty} sales</div><div class="mt-3"><button class="px-3 py-2 bg-cozy-orange text-white rounded" onclick="addToCart('${p.id}')">Add</button></div></div>`;
      grid.appendChild(card);
    });
    feather.replace();
  }

  // ---------- Quick view ----------
  function showQuick(id){
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]');
    const p = prods.find(x=>x.id===id); if(!p) return;
    showModal(`
      <div class="grid md:grid-cols-2 gap-4">
        <img src="${p.img}" class="w-full h-64 object-cover rounded" />
        <div>
          <h3 class="text-xl font-bold">${p.title}</h3>
          <div class="text-sm text-gray-500">${p.collection || ''}</div>
          <p class="mt-2 text-[color:var(--cozy-brown)]">${formatPrice(p.price)}</p>
          <p class="mt-2 text-gray-600">Stock: ${p.stock}</p>
          <div class="mt-4"><button class="px-4 py-2 bg-cozy-orange text-white rounded" onclick="addToCart('${p.id}')">Add to cart</button></div>
        </div>
      </div>
    `);
  }

  // ---------- Modal & toast ----------
  function showModal(html){
    const m = document.getElementById('modal'), p = document.getElementById('modalPanel');
    p.innerHTML = html; m.classList.remove('hidden'); m.style.display = 'flex';
    feather.replace();
    m.addEventListener('click', (evt)=>{ if(evt.target === m) closeModal(); });
  }
  function closeModal(){ const m = document.getElementById('modal'); m.style.display='none'; m.classList.add('hidden'); document.getElementById('modalPanel').innerHTML=''; }
  function toast(msg){ const t = document.createElement('div'); t.innerText = msg; Object.assign(t.style,{position:'fixed',right:'20px',bottom:'100px',background:'rgba(46,64,87,0.9)',color:'#fff',padding:'10px 14px',borderRadius:'10px',zIndex:9999}); document.body.appendChild(t); setTimeout(()=>t.remove(),2200); }

  // ---------- Search & sort ----------
  document.getElementById('searchBtn').addEventListener('click', performSearch);
  document.getElementById('globalSearch').addEventListener('keydown', (e)=>{ if(e.key==='Enter') performSearch(); });
  function performSearch(){ const q = document.getElementById('globalSearch').value.trim().toLowerCase(); const prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); const res = prods.filter(p=>p.title.toLowerCase().includes(q) || (p.collection||'').toLowerCase().includes(q)); renderSearchResults(res); }
  function renderSearchResults(items){ const grid = document.getElementById('productsGrid'); grid.innerHTML=''; if(items.length===0) grid.innerHTML = '<div class="text-gray-600">No results</div>'; items.forEach(p=>{ const card = document.createElement('div'); card.className='product-card bg-white rounded-lg overflow-hidden shadow-md transition duration-300'; card.innerHTML = `<div class="relative h-64 overflow-hidden"><img src="${p.img}" alt="${p.title}" class="w-full h-full object-cover" /></div><div class="p-4"><h3 class="font-medium text-lg mb-1">${p.title}</h3><div class="flex justify-between items-center"><span class="font-bold text-[color:var(--cozy-orange)]">${formatPrice(p.price)}</span><div class="flex gap-2"><button class="px-3 py-1 border rounded" onclick="showQuick('${p.id}')">Quick View</button><button class="add-to-cart px-3 py-1 bg-cozy-orange text-white rounded" data-id="${p.id}">Add</button></div></div></div>`; grid.appendChild(card); }); feather.replace(); attachProductButtons(); }

  // ---------- Admin footprint (no login) ----------
  // Methods: Ctrl+Shift+A OR click logo 5 times to open admin panel
  let logoClicks = 0;
  document.getElementById('logoWrap').addEventListener('click', () => { logoClicks++; if(logoClicks>=5){ openAdmin(); logoClicks=0; setTimeout(()=>logoClicks=0,600); }});
  document.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.shiftKey && (e.key==='A' || e.key==='a')) openAdmin(); });

  function openAdmin(){
    // Admin dashboard: view orders, add/edit products, export CSV
    const orders = JSON.parse(localStorage.getItem('bs_orders')||'[]');
    const products = JSON.parse(localStorage.getItem('bs_products')||'[]');
    showModal(`
      <div>
        <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Admin Dashboard (Hidden Footprint)</h2><div><button class="px-3 py-2 border rounded mr-2" onclick="closeModal()">Close</button></div></div>
        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-white p-4 rounded shadow">
            <h3 class="font-semibold mb-3">Add / Edit Product</h3>
            <form id="adminProductForm" class="space-y-2">
              <input name="id" placeholder="id (leave empty for new)" class="w-full border p-2 rounded" />
              <input name="title" placeholder="Title" class="w-full border p-2 rounded" required />
              <input name="price" type="number" placeholder="Price (DZD)" class="w-full border p-2 rounded" required />
              <input name="img" placeholder="Image URL" class="w-full border p-2 rounded" required />
              <input name="collection" placeholder="Collection" class="w-full border p-2 rounded" />
              <input name="stock" type="number" placeholder="Stock" class="w-full border p-2 rounded" />
              <div class="flex justify-end gap-2">
                <button type="button" class="px-3 py-2 border rounded" onclick="closeModal()">Close</button>
                <button class="px-3 py-2 bg-cozy-orange text-white rounded">Save</button>
              </div>
            </form>
          </div>

          <div class="bg-white p-4 rounded shadow">
            <h3 class="font-semibold mb-3">Recent Orders</h3>
            <div style="max-height:360px; overflow:auto" id="adminOrdersList">
              ${orders.slice(-20).reverse().map(o=>`<div class="border-b py-2"><strong>${o.id}</strong><div class="text-sm text-gray-500">${o.date}</div><div>Client: ${o.customer.name} — ${o.customer.phone}</div><div>Total: ${o.total.toLocaleString()} DZD</div></div>`).join('')}
            </div>
            <div class="mt-3 flex gap-2">
              <button class="px-3 py-2 border rounded" onclick="exportOrdersCSV()">Export CSV</button>
              <button class="px-3 py-2 border rounded" onclick="showAllOrders()">View All</button>
            </div>
          </div>
        </div>

        <div class="mt-6 bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Current Products (${products.length})</h3>
          <div style="max-height:240px;overflow:auto">
            ${products.map(p=>`<div class="border-b py-2 flex items-center justify-between"><div><strong>${p.title}</strong><div class="text-sm text-gray-500">${formatPrice(p.price)} · ${p.collection}</div></div><div><button class="px-2 py-1 border rounded mr-2" onclick="editProduct('${p.id}')">Edit</button><button class="px-2 py-1 border rounded text-red-600" onclick="deleteProduct('${p.id}')">Delete</button></div></div>`).join('')}
          </div>
        </div>
      </div>
    `);

    // handle save product inside modal
    document.getElementById('adminProductForm').addEventListener('submit', function(e){
      e.preventDefault();
      const fd = new FormData(e.target); const id = fd.get('id') || 'p' + Date.now();
      const prods = JSON.parse(localStorage.getItem('bs_products')||'[]');
      const existing = prods.find(p=>p.id===id);
      const obj = { id, title: fd.get('title'), price: Number(fd.get('price')), img: fd.get('img'), collection: fd.get('collection') || 'General', stock: Number(fd.get('stock') || 10), rating: 5, reviews: 0 };
      if(existing){ Object.assign(existing, obj); } else prods.push(obj);
      localStorage.setItem('bs_products', JSON.stringify(prods));
      closeModal(); loadProducts(); loadBestsellers(); toast('Product saved');
    });
  }

  function editProduct(id){
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); const p = prods.find(x=>x.id===id); if(!p) return;
    showModal(`<h3 class="text-xl font-bold mb-3">Edit Product</h3>
      <form id="editProductForm" class="space-y-2">
        <input name="id" value="${p.id}" class="w-full border p-2 rounded" readonly />
        <input name="title" value="${p.title}" class="w-full border p-2 rounded" required />
        <input name="price" value="${p.price}" type="number" class="w-full border p-2 rounded" required />
        <input name="img" value="${p.img}" class="w-full border p-2 rounded" required />
        <input name="collection" value="${p.collection||''}" class="w-full border p-2 rounded" />
        <input name="stock" value="${p.stock||0}" type="number" class="w-full border p-2 rounded" />
        <div class="flex justify-end gap-2"><button type="button" class="px-3 py-2 border rounded" onclick="closeModal()">Cancel</button><button class="px-3 py-2 bg-cozy-orange text-white rounded">Save</button></div>
      </form>`);
    document.getElementById('editProductForm').addEventListener('submit', function(e){
      e.preventDefault();
      const fd = new FormData(e.target); const id = fd.get('id');
      const prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); const existing = prods.find(x=>x.id===id);
      if(existing){ existing.title = fd.get('title'); existing.price = Number(fd.get('price')); existing.img = fd.get('img'); existing.collection = fd.get('collection'); existing.stock = Number(fd.get('stock')); localStorage.setItem('bs_products', JSON.stringify(prods)); closeModal(); loadProducts(); toast('Product updated'); }
    });
  }
  function deleteProduct(id){
    if(!confirm('Delete this product?')) return;
    let prods = JSON.parse(localStorage.getItem('bs_products')||'[]'); prods = prods.filter(p=>p.id!==id); localStorage.setItem('bs_products', JSON.stringify(prods)); loadProducts(); toast('Product deleted');
  }

  function exportOrdersCSV(){
    const orders = JSON.parse(localStorage.getItem('bs_orders')||'[]'); if(!orders.length) return alert('No orders');
    const header = 'id,date,name,phone,address,payment,subtotal,shipping,total\n';
    const rows = orders.map(o=>`"${o.id}","${o.date}","${o.customer.name}","${o.customer.phone}","${o.customer.address||''}","${o.payment}","${o.subtotal}","${o.shipping}","${o.total}"`).join('\n');
    const csv = header + rows; const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'orders.csv'; a.click(); URL.revokeObjectURL(url);
  }

  function showAllOrders(){
    const orders = JSON.parse(localStorage.getItem('bs_orders')||'[]');
    showModal(`<h3 class="text-xl font-bold mb-3">All Orders (${orders.length})</h3><div style="max-height:60vh;overflow:auto">${orders.reverse().map(o=>`<div class="border-b py-2"><strong>${o.id}</strong><div class="text-sm text-gray-500">${o.date}</div><div>Client: ${o.customer.name} — ${o.customer.phone}</div><div>Address: ${o.customer.address||''}</div><div>Items: ${o.items.map(i=>`${i.title} x${i.qty}`).join('; ')}</div><div>Total: ${o.total.toLocaleString()} DZD</div></div>`).join('')}</div>`);
  }

  // ---------- Small UI & init ----------
  document.getElementById('sortSelect').addEventListener('change', function(){ sortProducts(this.value); });
  document.getElementById('newsletterForm').addEventListener('submit', function(e){ e.preventDefault(); toast('Subscribed — thank you'); this.reset(); });
  document.getElementById('contactForm').addEventListener('submit', function(e){ e.preventDefault(); toast('Message sent — we will reply soon'); this.reset(); });
  document.getElementById('viewAllBtn').addEventListener('click', ()=>{ toast('Showing all products'); });

  function sortProducts(mode){
    const prods = JSON.parse(localStorage.getItem('bs_products')||'[]');
    if(mode === 'price_asc') prods.sort((a,b)=>a.price-b.price);
    else if(mode === 'price_desc') prods.sort((a,b)=>b.price-a.price);
    else if(mode === 'popularity'){ const sales = JSON.parse(localStorage.getItem('bs_sales')||'{}'); prods.sort((a,b)=> (sales[b.id]||0) - (sales[a.id]||0)); }
    localStorage.setItem('bs_products', JSON.stringify(prods)); loadProducts();
  }

  // ---------- logo click / lang dropdown handlers ----------
  document.getElementById('langBtn').addEventListener('click', e=>{ e.stopPropagation(); document.getElementById('langDropdown').classList.toggle('hidden'); });
  window.addEventListener('click', ()=> document.getElementById('langDropdown').classList.add('hidden'));
  document.querySelectorAll('#langDropdown button').forEach(b=> b.addEventListener('click', ()=>{ const lang=b.dataset.lang; document.getElementById('langLabel').innerText = lang.toUpperCase(); if(lang==='ar') document.documentElement.setAttribute('dir','rtl'); else document.documentElement.setAttribute('dir','ltr'); document.getElementById('langDropdown').classList.add('hidden'); }));

  // ---------- helpers ----------
  function loadInitialUI(){ loadProducts(); loadBestsellers(); updateCartUI(); const w = JSON.parse(localStorage.getItem('bs_wishlist')||'{}'); document.getElementById('wishCount').innerText = Object.keys(w).length; }
  loadInitialUI();

  // expose a few functions for inline onclicks
  window.openCart = openCart; window.closeCart = closeCart; window.checkout = checkout; window.showQuick = showQuick; window.addToCart = addToCart; window.editProduct = editProduct; window.deleteProduct = deleteProduct; window.openAdmin = openAdmin; window.clearCart = clearCart;

  </script>
</body>
</html>
